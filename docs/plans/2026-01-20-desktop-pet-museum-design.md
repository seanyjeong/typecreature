# TypeCreature 확장 기능 설계

## 개요

기존 타이핑 다마고치에 바탕화면 펫, 박물관 전시장 UI, 미니위젯 개선 기능을 추가한다.

## 구현 순서

1. 바탕화면 펫
2. 전시장 (박물관) UI
3. 미니위젯 & 트레이 아이콘 개선

---

## 1. 바탕화면 펫

### 새로운 컴포넌트

| 파일 | 설명 |
|------|------|
| `Views/DesktopPetWindow.axaml` | 투명 윈도우, 크리처 1마리 표시 |
| `ViewModels/DesktopPetViewModel.cs` | 크리처 상태, 위치, 행동 관리 |
| `Services/DesktopPetService.cs` | 여러 펫 윈도우 생성/관리, 충돌 감지 |

### 동작 방식

- 각 크리처마다 독립적인 투명 윈도우 생성
- 윈도우는 `Topmost=true`로 항상 위에 표시
- 배경 투명 처리로 크리처만 보임
- 사용자가 컬렉션에서 선택한 크리처만 표시 (최대 개수 제한)

### 크리처 행동 상태

| 상태 | 설명 |
|------|------|
| `Idle` | 제자리에서 대기 |
| `Walking` | 좌/우로 이동 |
| `Sitting` | 앉아있기 |
| `Greeting` | 다른 크리처와 인사 (근처에 있을 때) |
| `Dragging` | 사용자가 드래그 중 |

### 위치/이동

- 화면 하단(바닥)을 기준으로 걸어다님
- 랜덤하게 방향 전환
- 화면 끝에 도달하면 반대로 이동

### 상호작용

**클릭:**
- 크리처 클릭 시 반응 애니메이션 (점프 또는 흔들림)
- 우클릭 시 컨텍스트 메뉴: "돌려보내기" (바탕화면에서 제거)

**드래그:**
- 마우스로 크리처를 잡아서 원하는 위치로 이동
- 드래그 중에는 발버둥 치는 애니메이션
- 놓으면 그 자리에서 다시 행동 시작

**크리처 간 상호작용:**
- 두 크리처가 일정 거리(50px) 이내로 가까워지면 인사
- 둘 다 멈추고 서로 마주보며 인사 모션 (1~2초)
- 인사 후 각자 다른 방향으로 이동

### 애니메이션 구현

- 현재 에셋이 단일 이미지이므로 간단한 변형으로 처리:
  - 걷기: 좌우 흔들림 + 위치 이동
  - 점프: Y축 바운스
  - 인사: 살짝 숙이기 (스케일/회전)

---

## 2. 전시장 (박물관) UI

### 새로운 컴포넌트

| 파일 | 설명 |
|------|------|
| `Views/MuseumWindow.axaml` | 박물관 전시장 메인 화면 |
| `ViewModels/MuseumViewModel.cs` | 수집한 크리처 목록, 선택 상태 관리 |

### 레이아웃

- 스크롤 가능한 전시 공간
- 희귀도별 구역 분리 (Common → Rare → Epic → Legendary)
- Legendary 구역은 특별 조명/받침대로 강조

### 받침대 & 명패

- 각 크리처마다 받침대 이미지 위에 크리처 배치
- 받침대 아래 명패: 이름, 희귀도, 획득일
- 미획득 크리처는 실루엣 + "???" 표시

### 제자리 애니메이션

- 위아래 살짝 떠다니는 효과 (floating)
- 또는 좌우 미세하게 흔들림 (breathing)

### 바탕화면에 꺼내기

- 크리처 클릭 → "바탕화면에 꺼내기" 버튼
- 이미 꺼내진 크리처는 "돌려놓기" 버튼으로 변경
- 최대 개수 초과 시 알림 표시

---

## 3. 미니위젯 & 트레이 아이콘 개선

### 미니위젯 전환 동작

- 미니위젯 활성화 시 → 메인 창 숨김 (Close 아님, Hide)
- 트레이 아이콘 더블클릭 → 메인 창 다시 표시
- 미니위젯에서 알 부화 시 → 알림 팝업으로 표시

### 트레이 아이콘 개선

- 기본: 가장 최근 획득한 크리처 이미지
- 또는: 사용자가 "대표 크리처"로 지정한 이미지
- 크리처 없으면 알 이미지로 표시
- 아이콘 크기에 맞게 리사이즈 (16x16 또는 32x32)

### 트레이 메뉴 수정

- 메인 창 열기
- 전시장 열기 (새로 추가)
- 미니위젯 켜기/끄기
- 바탕화면 펫 전체 숨기기/보이기 (새로 추가)
- 종료

### 미니위젯 표시 내용

- 현재 알 진행도
- 바탕화면에 있는 크리처 수 (예: 🐾 3마리)

---

## 기술 참고사항

### Avalonia 투명 윈도우

```csharp
// DesktopPetWindow.axaml
<Window
    Background="Transparent"
    TransparencyLevelHint="Transparent"
    SystemDecorations="None"
    Topmost="True">
```

### 최대 펫 수 설정

- 기본값: 5마리
- 설정에서 변경 가능 (1~10)

### 데이터 저장

- `desktop_pets` 테이블 추가: 현재 바탕화면에 있는 크리처 ID 목록
- `settings` 테이블 추가: 최대 펫 수, 대표 크리처 ID 등
