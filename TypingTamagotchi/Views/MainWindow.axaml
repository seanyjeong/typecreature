<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TypingTamagotchi.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="300"
        x:Class="TypingTamagotchi.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Typing Tamagotchi"
        Width="400" Height="300"
        WindowStartupLocation="CenterScreen">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid>
        <!-- 메인 화면 -->
        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20">
            <!-- 알 이름 -->
            <TextBlock Text="{Binding EggName}"
                       FontSize="24"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"/>

            <!-- 알 이미지 (placeholder) -->
            <Border Width="100" Height="100"
                    Background="#FFE4B5"
                    CornerRadius="50"
                    HorizontalAlignment="Center">
                <TextBlock Text="&#x1F95A;"
                           FontSize="48"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Border>

            <!-- 진행도 -->
            <StackPanel Spacing="5">
                <ProgressBar Value="{Binding Progress}"
                             Minimum="0" Maximum="1"
                             Width="250" Height="20"/>
                <TextBlock Text="{Binding ProgressText}"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- 수집 현황 (클릭하면 도감 열기) -->
            <Button Command="{Binding OpenCollectionCommand}"
                    HorizontalAlignment="Center"
                    Background="Transparent"
                    BorderThickness="0"
                    Cursor="Hand">
                <TextBlock Text="{Binding CollectionStatus, StringFormat='수집: {0}'}"
                           Foreground="Gray"
                           TextDecorations="Underline"/>
            </Button>

            <!-- 미니 위젯 토글 -->
            <Button Command="{Binding ToggleWidgetCommand}"
                    HorizontalAlignment="Center"
                    Padding="15,5"
                    Margin="0,5,0,0">
                <TextBlock Text="{Binding IsWidgetVisible, Converter={x:Static vm:WidgetButtonTextConverter.Instance}}"/>
            </Button>
        </StackPanel>

        <!-- 부화 팝업 -->
        <Border IsVisible="{Binding IsHatchPopupVisible}"
                Background="#80000000"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <Border Background="White"
                    CornerRadius="10"
                    Padding="30"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MinWidth="300">
                <StackPanel Spacing="15">
                    <TextBlock Text="부화!"
                               FontSize="24"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"/>

                    <!-- 크리처 이미지 -->
                    <Border Width="80" Height="80"
                            Background="#E8F5E9"
                            CornerRadius="10"
                            HorizontalAlignment="Center"
                            ClipToBounds="True">
                        <Image Source="{Binding HatchedCreature.SpritePath, Converter={x:Static vm:SpritePathToImageConverter.Instance}}"
                               Width="72" Height="72"
                               Stretch="Uniform"/>
                    </Border>

                    <TextBlock Text="{Binding HatchedCreature.Name}"
                               FontSize="20"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"/>

                    <TextBlock Text="{Binding HatchedCreature.Rarity}"
                               HorizontalAlignment="Center"
                               Foreground="Purple"/>

                    <TextBlock Text="{Binding HatchedCreature.Description}"
                               HorizontalAlignment="Center"
                               Foreground="Gray"
                               TextWrapping="Wrap"/>

                    <Button Content="확인"
                            Command="{Binding CloseHatchPopupCommand}"
                            HorizontalAlignment="Center"
                            Padding="30,10"/>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</Window>
